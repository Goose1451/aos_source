<!DOCTYPE html>
<html>
<head>

    <meta http-equiv="Content-type" content="text/html; charset=ISO-8859-1">
    <title>Advantage Online Shopping Demo Support Chat</title>

    <link href="css/chat/chat.css">
    <script href="vendor/angular/angular.min.js" type="text/javascript"></script>
    <script href="app/controller/chatCtrl"></script>

    <script type="text/javascript">

        window.onload = function () {
            setTimeout(function(){

                var webSocket;
                try {
                    var serverKey = sessionStorage.getItem("serverKey");
                    sessionStorage.removeItem("serverKey");
                    if (serverKey == null) {
                        window.close();
                    }
                    webSocket = new WebSocket("ws://"+serverKey+"/websocketserverendpoint")
                    var messagesTextArea = document.getElementById("messagesTextArea");

                    webSocket.onopen = function () {
                        messagesTextArea.value += "Server connect.\n";
                    };

                    webSocket.onmessage = function (message) {
                        messagesTextArea.value += message.data + "\n";
                    };

                    webSocket.onclose = function () {
                        webSocket.send("client disconnected...");
                        messagesTextArea.value += "Server disconnect...\n";
                    };

                    webSocket.onerror = function (message) {
                        messagesTextArea.value += "Error: " + message + "\n";
                    };

                    var input = document.getElementById("btnSender");
                    input.onclick = function () {
                        if (textMessage.value != "close") {
                            webSocket.send(textMessage.value);
                            messagesTextArea.value += textMessage.value + "\n";
                            textMessage.value = "";
                        } else {
                            webSocket.close();
                        }
                    };
                } finally {
                    if(webSocket && webSocket.isOpen()){
                        webSocket.close();
                    }
                }
            }, 0);
        }
    </script>


</head>

<body style="overflow: hidden" ng-app="advantageDemo">

<input id="textMessage" type="text">
<input id="btnSender" value="Send Message" type="button">
<br/>
<textarea id="messagesTextArea" rows="10" cols="50"></textarea>

</body>
</html>